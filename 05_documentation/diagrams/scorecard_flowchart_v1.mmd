%% MoSCoW Scorecard Data Flow - v4.0 Evolution
%% Mermaid Diagram Source

flowchart TB
    %% Current State (v3.2.0)
    subgraph current["Current System v3.2.0"]
        A[Developer Git Push] --> B[CI Trigger]
        B --> C[Python Validator Core]
        C --> D[CLI --scorecard]
        D --> E1[Terminal Output]
        D --> E2[JSON Export]
        D --> E3[Markdown Export]
        E2 --> F1[CI Artifacts<br/>90 days]
        E2 --> F2[Registry Storage<br/>Permanent]
        F2 --> G[Trend Analysis Script]
        G --> H[Markdown Reports]
    end

    %% Future State Stage 1 (API)
    subgraph stage1["Stage 1: GraphQL/REST API"]
        F2 --> API[GraphQL/REST API]
        API --> DASH[Live Dashboard]
        API --> EXT[External Integrations]
        API --> QUERY[Historical Queries]
    end

    %% Future State Stage 2 (Self-Healing)
    subgraph stage2["Stage 2: Self-Healing Engine"]
        C --> SH[Self-Healing Engine]
        SH --> LLM[LLM API<br/>Claude/GPT-4]
        LLM --> PATCH[JSON Patch<br/>Generation]
        PATCH --> CLI_APPLY[CLI Auto-Apply]
        CLI_APPLY --> REVAL[Revalidation]
    end

    %% Future State Stage 3 (Interfederation)
    subgraph stage3["Stage 3: Interfederation Bridge"]
        API --> FED[Federation Merger]
        FED --> COMP[Multi-System<br/>Comparison]
        COMP --> DRIFT[Drift Detection]
        DRIFT --> SYNC[Sync<br/>Recommendations]
    end

    %% Future State Stage 4 (MCI)
    subgraph stage4["Stage 4: MCI Analytics"]
        API --> MCI[MCI Calculator]
        MCI --> METRIC[Meta-Compliance<br/>Metrics]
        METRIC --> EXEC[Executive<br/>Dashboard]
    end

    %% Styling
    classDef currentClass fill:#e1f5e1,stroke:#4caf50,stroke-width:2px
    classDef apiClass fill:#e3f2fd,stroke:#2196f3,stroke-width:2px
    classDef aiClass fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    classDef fedClass fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
    classDef mciClass fill:#fce4ec,stroke:#e91e63,stroke-width:2px

    class current currentClass
    class stage1 apiClass
    class stage2 aiClass
    class stage3 fedClass
    class stage4 mciClass
