meta:
  version: "1.0.0"
  protocol_name: "SSID Federated Evidence Protocol"
  status: "active"
  created: "2025-10-07T00:00:00Z"
  last_updated: "2025-10-07T00:00:00Z"
  maintainer: "edubrainboost"
  classification: "OPERATIONAL - P2P Audit Network"

description: |
  Federated Evidence Protocol enabling P2P audit network between SSID instances.
  Multiple SSID deployments mutually verify and cross-sign compliance anchors,
  creating a decentralized audit network without central oversight.

  Key Features:
  - Mutual anchor verification between peer nodes
  - Cryptographic cross-signing of evidence chains
  - Distributed consensus on compliance state
  - Byzantine fault tolerance
  - Sybil attack resistance

architecture:
  network_topology: "mesh"
  consensus_mechanism: "threshold_signature"
  min_peer_signatures: 3
  max_network_size: 100
  heartbeat_interval: "300s"
  evidence_sync_interval: "3600s"

node_roles:
  - role: "validator"
    description: "Full node with validation and signing capabilities"
    requirements:
      - "Complete SSID implementation"
      - "Valid SSL/TLS certificate"
      - "Minimum 99% uptime"
      - "Public endpoint accessible"
    permissions:
      - "sign_anchors"
      - "validate_peers"
      - "propose_evidence"
      - "vote_consensus"

  - role: "observer"
    description: "Read-only node for audit trail verification"
    requirements:
      - "Valid authentication token"
      - "Network connectivity"
    permissions:
      - "read_anchors"
      - "verify_signatures"

  - role: "auditor"
    description: "External auditor with verification rights"
    requirements:
      - "Third-party auditor credentials"
      - "Authenticated session"
    permissions:
      - "read_anchors"
      - "verify_signatures"
      - "export_evidence"
      - "generate_reports"

peer_discovery:
  mechanisms:
    - type: "bootstrap"
      description: "Well-known bootstrap nodes"
      bootstrap_nodes:
        - "https://ssid-bootstrap-1.example.com"
        - "https://ssid-bootstrap-2.example.com"
        - "https://ssid-bootstrap-3.example.com"

    - type: "dns_seed"
      description: "DNS-based peer discovery"
      dns_seeds:
        - "peers.ssid-federation.org"

    - type: "peer_exchange"
      description: "Exchange peer lists with connected nodes"
      max_peers_shared: 10

anchor_verification_protocol:
  steps:
    - step: 1
      name: "Announce New Anchor"
      description: "Node broadcasts new compliance anchor to all connected peers"
      payload:
        - anchor_hash: "sha256"
        - timestamp: "ISO8601"
        - node_id: "ed25519_public_key"
        - evidence_summary: "compressed_json"
        - signature: "ed25519_signature"

    - step: 2
      name: "Peer Retrieval"
      description: "Peers retrieve full anchor data via authenticated API"
      endpoint: "GET /api/v1/anchors/{anchor_hash}"
      authentication: "mutual_tls"

    - step: 3
      name: "Independent Verification"
      description: "Each peer independently validates anchor integrity"
      checks:
        - "signature_verification"
        - "merkle_root_validation"
        - "policy_compliance_check"
        - "timestamp_validity"
        - "evidence_chain_integrity"

    - step: 4
      name: "Cross-Signing"
      description: "Validators sign verified anchors with their key"
      signature_format:
        signer_node_id: "ed25519_public_key"
        anchor_hash: "sha256"
        verification_result: "PASS|FAIL"
        timestamp: "ISO8601"
        signature: "ed25519_signature"

    - step: 5
      name: "Threshold Consensus"
      description: "Anchor accepted when min_peer_signatures reached"
      consensus_threshold: 3
      quorum_requirement: "majority"

    - step: 6
      name: "Federated Anchor Registration"
      description: "Anchor registered in distributed evidence registry"
      storage: "distributed_hash_table"
      replication_factor: 5

security_mechanisms:
  sybil_resistance:
    - mechanism: "proof_of_authority"
      description: "Validators must stake reputation or provide credentials"
      validator_onboarding: "manual_verification"

    - mechanism: "rate_limiting"
      description: "Limit anchor proposals per node per timeframe"
      max_anchors_per_hour: 10

  byzantine_fault_tolerance:
    - mechanism: "threshold_signatures"
      description: "Require multiple independent signatures"
      threshold: "n/2 + 1"

    - mechanism: "outlier_detection"
      description: "Flag nodes with abnormal validation patterns"
      metrics:
        - "false_positive_rate"
        - "response_time"
        - "uptime_percentage"

  attack_mitigation:
    - attack: "eclipse_attack"
      mitigation: "Diversified peer connections, manual peer pinning"

    - attack: "replay_attack"
      mitigation: "Timestamp validation, nonce inclusion"

    - attack: "man_in_the_middle"
      mitigation: "Mutual TLS, certificate pinning"

evidence_synchronization:
  sync_strategy: "incremental"
  sync_protocol: "rsync-like_delta_sync"
  conflict_resolution: "latest_timestamp_wins"

  sync_phases:
    - phase: "discovery"
      action: "Exchange merkle roots of evidence trees"

    - phase: "diff_calculation"
      action: "Identify missing or divergent evidence"

    - phase: "bulk_transfer"
      action: "Transfer missing evidence chunks"

    - phase: "verification"
      action: "Validate received evidence integrity"

    - phase: "integration"
      action: "Merge verified evidence into local store"

api_endpoints:
  - endpoint: "/api/v1/federation/announce"
    method: "POST"
    description: "Announce new anchor to network"
    authentication: "ed25519_signature"
    rate_limit: "10/hour"

  - endpoint: "/api/v1/federation/anchors/{hash}"
    method: "GET"
    description: "Retrieve anchor by hash"
    authentication: "mutual_tls"
    rate_limit: "100/hour"

  - endpoint: "/api/v1/federation/verify/{hash}"
    method: "POST"
    description: "Submit cross-signature for anchor"
    authentication: "ed25519_signature"
    rate_limit: "50/hour"

  - endpoint: "/api/v1/federation/peers"
    method: "GET"
    description: "List known peers"
    authentication: "api_key"
    rate_limit: "10/minute"

  - endpoint: "/api/v1/federation/sync"
    method: "POST"
    description: "Initiate evidence synchronization"
    authentication: "mutual_tls"
    rate_limit: "1/hour"

monitoring_metrics:
  node_health:
    - metric: "peer_count"
      threshold: ">= 3"
      alert_level: "warning"

    - metric: "anchor_verification_rate"
      threshold: "> 90%"
      alert_level: "critical"

    - metric: "sync_lag"
      threshold: "< 1 hour"
      alert_level: "warning"

  network_health:
    - metric: "consensus_time"
      threshold: "< 5 minutes"
      alert_level: "info"

    - metric: "byzantine_node_detection"
      threshold: "> 0"
      alert_level: "critical"

governance:
  protocol_upgrades:
    proposal_mechanism: "signed_proposal_from_validator"
    voting_period: "30_days"
    acceptance_threshold: "66%_of_validators"

  validator_onboarding:
    process: "application_review"
    criteria:
      - "Demonstrated SSID implementation"
      - "Legal entity verification"
      - "Technical capability assessment"
      - "Community endorsement"

  dispute_resolution:
    mechanism: "arbitration_panel"
    panel_composition: "3_independent_validators"
    decision_binding: true

integration_points:
  anchor_source: "02_audit_logging/evidence/registry/registry_anchor.json"
  blockchain_integration: "24_meta_orchestration/compliance_chain_trigger.py"
  api_implementation: "23_compliance/federated_evidence/federation_node.py"
  monitoring_dashboard: "13_ui_layer/federation_monitor.py"

references:
  - title: "Consensus Mechanisms in Distributed Systems"
    url: "https://en.wikipedia.org/wiki/Consensus_(computer_science)"

  - title: "Byzantine Fault Tolerance"
    url: "https://en.wikipedia.org/wiki/Byzantine_fault"

  - title: "Ed25519 Signature Scheme"
    url: "https://ed25519.cr.yp.to/"
